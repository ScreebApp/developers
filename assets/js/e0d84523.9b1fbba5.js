"use strict";(self.webpackChunkscreeb_docs=self.webpackChunkscreeb_docs||[]).push([[2876],{2463:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var t=r(4848),a=r(8453);const s={sidebar_class_name:"hidden"},i="Feature Flagging",c={id:"feature-flagging",title:"Feature Flagging",description:"I paid for 100k MAU, but my application has 1m MAU",source:"@site/docs/sdk-js/feature-flagging.md",sourceDirName:".",slug:"/feature-flagging",permalink:"/sdk-js/feature-flagging",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{sidebar_class_name:"hidden"},sidebar:"docSidebar",previous:{title:"Device tracking",permalink:"/sdk-js/device-tracking"}},o={},l=[{value:"I paid for 100k MAU, but my application has 1m MAU",id:"i-paid-for-100k-mau-but-my-application-has-1m-mau",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"feature-flagging",children:"Feature Flagging"}),"\n",(0,t.jsx)(n.h2,{id:"i-paid-for-100k-mau-but-my-application-has-1m-mau",children:"I paid for 100k MAU, but my application has 1m MAU"}),"\n",(0,t.jsx)(n.p,{children:"For large B2C applications, your Screeb quota may be consumed very fast. Until the end of the current month, you will be able to survey only the first XXX MAU allowed by your quota."}),"\n",(0,t.jsx)(n.p,{children:"In order to distribute your quota throughout the month, please use the following code:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'function isScreebEnabledForCurrentUser(userId: string, country: string): boolean {\n  // Screeb will be loaded for 100% of japan users\n  if (country === "ja") {\n    return true;\n  }\n\n  const hash = cyrb53Hash(userId, 42);\n\n  // Screeb will be loaded for 10% of the rest of the audience.\n  return hash % 10 === 0;\n}\n\n// https://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript\nfunction cyrb53Hash(str: string, seed: number): number {\n  let h1 = 0xdeadbeef ^ seed,\n    h2 = 0x41c6ce57 ^ seed;\n  for (let i = 0, ch; i < str.length; i++) {\n    ch = str.charCodeAt(i);\n    h1 = Math.imul(h1 ^ ch, 2654435761);\n    h2 = Math.imul(h2 ^ ch, 1597334677);\n  }\n\n  h1 =\n    Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^\n    Math.imul(h2 ^ (h2 >>> 13), 3266489909);\n  h2 =\n    Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^\n    Math.imul(h1 ^ (h1 >>> 13), 3266489909);\n\n  return 4294967296 * (2097151 & h2) + (h1 >>> 0);\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then for each call to a Screeb command, check that the user is enabled to load Screeb:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if (isScreebEnabledForUser(\"user-123\",  'us')) {\n  $screeb('init', ...)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if (isScreebEnabledForUser(\"user-123\",  'us')) {\n  $screeb('event.track', ...)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if (isScreebEnabledForUser(\"user-123\",  'us')) {\n  $screeb('identity.group.assign', ...)\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To vary your audience every month, please update the ",(0,t.jsx)(n.code,{children:"seed"})," parameter in ",(0,t.jsx)(n.code,{children:"cyrb53Hash"}),". Eg: ",(0,t.jsx)(n.code,{children:"cyrb53Hash(userId, new Date().getMonth())"})]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var t=r(6540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);